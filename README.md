–†–∞–±–æ—Ç–∞ –±–æ—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ API –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ **node.js** –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–π –Ω–∞ **JS** —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º **TG API**. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ —è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `bot.js` –æ–±—Ä–∞—â–∞—é—Å—å –∫ API –æ–ø–∏—Å–∞–Ω–Ω—ã–º –≤ —Ñ–∞–π–ª–µ `server.js`, –∞ —Ç–µ, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –æ–±—â–∞—é—Ç—Å—è —Å –±–∞–∑–æ–π –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `bot.js`, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ–Ω –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ TG —á–µ—Ä–µ–∑ **TG API**.

## <span style="color:rgb(41, 128, 185)">–ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</span> 

1. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ `server.js`, –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
2. –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã `/start` –≤ –±–æ—Ç–µ, –¥–æ–ª–∂–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–æ–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `bot.on('message' async (msg) => { })`
3. –î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ø–∏—Å–∞—Ç—å API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º. 
	1. API –≤—ã–≤–æ–¥–∞ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `tula_oit` `/api/employees'`
	2. API –≤—ã–≤–æ–¥–∞ —Å–ø–∏—Å–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `equipment` `/api/equipment/show`
	3. API –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–º–æ–Ω—Ç `/api/equipment`
	4. API –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏–∑ —Ä–µ–º–æ–Ω—Ç–∞ `/api/equipment/fromRepair`
	5. API —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è `/api/equipment/createfile`
4. –ù–∞–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ –∏ –æ–±—â–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç—å—é —á–µ—Ä–µ–∑ `axios`
## <span style="color:rgb(41, 128, 185)">–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</span>

1. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π `PostgreSQL` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞–∫–µ—Ç `pg`. –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è –∏–º—è –∫–ª–∞—Å—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ, –≤ –º–æ–µ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å `Client`, —Ç–∞–∫ –∫–∞–∫ —è —Ä–∞–±–æ—Ç–∞—é —Å 1-–æ–π –±–∞–∑–æ–π –∏ —Å 1-–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º, –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É–ª–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å `Pool`.
2. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ `express`. –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞, –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –æ–±—ã—á–Ω–æ `app`, –∑–Ω–∞—á–µ–Ω–∏–µ–º –∫–æ—Ç–æ—Ä–æ–π —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `express()`. –î–∞–ª–µ–µ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON —Ñ–∞–π–ª–æ–≤ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é API —Å –º–µ—Ç–æ–¥–∞–º–∏ `post –∏ put`.
3. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è CSV —Ñ–∞–π–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `createObjectCsvWriter` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞–∫–µ—Ç–∞ `csv-writer`.
4. –î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞–∫–µ—Ç `fs`.
5. –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è  TG API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å `TelegramBot` –∏–∑ –ø–∞–∫–µ—Ç–∞ `node-telegram-bot-api`. –î–∞–ª–µ–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞, –≤ –º–æ–µ–º —Å–ª—É—á–∞–µ —Å –∏–º–µ–Ω–µ–º `bot`, –≤—Å–µ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å TG API –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞.
6. –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É —Ñ–∞–π–ª–æ–º –±–æ—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `axios` –∏–∑ –æ–¥–Ω–æ–∏–º–µ–Ω–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –≤—Å–µ–≥–¥–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ.
7. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–∞–∫–µ—Ç `dotenv`, –¥–∞–ª–µ–µ —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É —Å–≤–æ–π—Å—Ç–≤ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ç–æ –∏–ª–∏ –∏–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: `process.env.BOT_PASSWORD` –ø–æ–ª—É—á–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ BOW_PASSWORD –∏–∑ —Ñ–∞–π–ª–∞ `.env`

## <span style="color:rgb(41, 128, 185)">–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ API —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞.</span> 

–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ `üìÅ /file`:

–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ `axios`:
```js
const createFile = async () => {
try {
	await axios.post('http://localhost:6000/api/equipment/createfile');
	return true;
} catch (err) {
	console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:', err);
	return false;
	}
};
```

–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏:
```js

bot.onText(/\/file/, async (msg) => {
const chatId = msg.chat.id;

if (!authorizedUsers.has(chatId)) {
	return bot.sendMessage(chatId, '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã /start.');
}
const filePath = './equipment_list.csv';

const fileCreated = await createFile();
if (!fileCreated) {
	return bot.sendMessage(chatId, '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞.');
}

if (!fs.existsSync(filePath)) {
	return bot.sendMessage(chatId, '–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω.');
}
  
bot.sendDocument(chatId, filePath)
.then(() => {
	console.log('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.');
	fs.unlinkSync(filePath);
	})
.catch(err => {
	console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–∞:', err);
	bot.sendMessage(chatId, '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–∞.');
	});
});
```

–û–±—Ä–∞–±–æ—Ç–∫–∞ `axios` –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø–æ–º–æ—â—å—é `express`

```js
app.post('/api/equipment/createfile', async (req, res) => {
try{
const result = await client.query(
`
SELECT e.*, s.fio AS sender_fio, r.fio AS reciver_fio
FROM equipment e
LEFT JOIN tula_oit s ON e.sender_id = s.id
LEFT JOIN tula_oit r ON e.reciver_id = r.id`
);

const csvWriter = createObjectCsvWriter({
path: './equipment_list.csv',
header: [
{ id: 'sn', title: '–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä' },
{ id: 'send_date', title: '–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏' },
{ id: 'sender_fio', title: '–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å' },
{ id: 'recive_date', title: '–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∫–∏' },
{ id: 'reciver_fio', title: '–ü—Ä–∏–Ω–∏–º–∞—é—â–∏–π' },
{ id: 'status', title: '–°—Ç–∞—Ç—É—Å' },
],

encoding: 'utf8',
})

const records = result.rows.map(row => ({
sn: row.sn,
send_date: row.send_date,
sender_fio: row.sender_fio || '–ù–µ —É–∫–∞–∑–∞–Ω',
recive_date: row.recive_date || '–ù–µ —É–∫–∞–∑–∞–Ω',
reciver_fio: row.reciver_fio || '–ù–µ —É–∫–∞–∑–∞–Ω',
status: row.status,
}));

await csvWriter.writeRecords(records);
 

const data = fs.readFileSync('./equipment_list.csv', 'utf8');
fs.writeFileSync('./equipment_list.csv', '\uFEFF' + data, 'utf8');


console.log('CSV-—Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω.');
res.status(200).send('–§–∞–π–ª —Å–æ–∑–¥–∞–Ω');
} catch (err){
console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞', err);
res.status(500).send('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞');
}
});
```
